<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›”ë§í‰ê°€ ì¶œì œ ë§ˆë²•ì‚¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        /* [ë””ìì¸ í•µì‹¬] ì„ ìƒë‹˜ ë©”ì¸ê³¼ ë™ì¼í•œ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” (íˆ¬ëª…ë„ ì¡°ì ˆ) */
        .navbar-top {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            flex-shrink: 0;
        }

        /* ë§ˆë²•ì‚¬ ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .wizard-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 20px; /* ì—¬ë°± ì¶”ê°€ */
            gap: 15px;
        }

        /* í°ìƒ‰ ë‘¥ê·¼ íŒ¨ë„ ìŠ¤íƒ€ì¼ (ì¹´ë“œ í˜•íƒœ) */
        .wizard-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* í—¤ë” ì˜ì—­ */
        .wizard-header-card {
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* í•˜ë‹¨ ë³¸ë¬¸ (ì¢Œìš° íŒ¨ë„ í¬í•¨) */
        .wizard-body {
            flex-grow: 1;
            display: flex;
            gap: 20px;
            overflow: hidden;
        }
        
        /* ì™¼ìª½ (ì„¤ì •/ê²€ìƒ‰) */
        .left-panel {
            width: 380px; 
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            display: flex; flex-direction: column; overflow-y: auto;
            padding: 20px; flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* ì˜¤ë¥¸ìª½ (ì‹œí—˜ì§€ êµ¬ì„±) */
        .right-panel {
            flex-grow: 1;
            display: flex; gap: 20px;
            overflow: hidden;
        }
        
        /* ì„¹ì…˜ ì¹´ë“œ (Part 1, Part 2) */
        .section-card { 
            flex: 1; 
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            display: flex; flex-direction: column; 
            overflow: hidden;
        }

        .section-header {
            padding: 15px; font-weight: bold; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            background-color: white;
        }
        .section-body { flex-grow: 1; overflow-y: auto; padding: 10px; background-color: #f8f9fa; }
        
        /* ë¬¸ì œ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .question-item { 
            background: #fff; border: 1px solid #eee; border-radius: 10px; 
            padding: 12px; margin-bottom: 8px; cursor: pointer; 
            transition: all 0.2s; position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .question-item:hover { 
            border-color: #667eea; 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .question-item .badge { font-size: 0.7rem; margin-right: 5px; }
        
        .question-item .remove-btn { 
            position: absolute; top: 8px; right: 8px; 
            color: #dc3545; display: none; cursor: pointer;
        }
        .question-item:hover .remove-btn { display: block; }
        
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .added-item { animation: fadeIn 0.3s ease-out; }

        /* [ì¶”ê°€] ìŠ¬ë¼ì´ë” íŠ¸ë™(ë°”) ê°•ì œ ìƒ‰ìƒ ì§€ì • */
        .form-range::-webkit-slider-runnable-track {
            background: #dee2e6; /* ì§„í•œ íšŒìƒ‰ */
            height: 0.5rem;
            border-radius: 1rem;
        }
        .form-range::-moz-range-track {
            background: #dee2e6;
            height: 0.5rem;
            border-radius: 1rem;
        }
        
        /* ìŠ¬ë¼ì´ë” ì†ì¡ì´(ë™ê·¸ë¼ë¯¸) ë””ìì¸ ê°•í™” */
        .form-range::-webkit-slider-thumb {
            margin-top: -0.25rem; /* ì¤‘ì•™ ì •ë ¬ ë³´ì • */
        }
    </style>
</head>
<body>

    <nav class="navbar-top">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <a href="{% url 'core:teacher_home' %}" class="text-decoration-none">
                <span class="fw-bold text-primary fs-5">ğŸŒ¸ ë¸”ë¼ì¸ì—ë“€</span>
            </a>
            <div class="d-flex align-items-center gap-2">
                <span class="text-muted small fw-bold">
                    {% if user.staff_profile %}
                        {{ user.staff_profile.name }} T
                    {% else %}
                        {{ user.username }} T
                    {% endif %}
                </span>
                <form method="post" action="{% url 'core:logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-light border"><i class="bi bi-box-arrow-right"></i></button>
                </form>
            </div>
        </div>
    </nav>

    <div class="wizard-container">
        <form method="post" action="{% url 'exam:exam_create' %}" id="examForm" style="display:contents;">
            {% csrf_token %}
            
            <div class="wizard-header-card">
                <div class="d-flex align-items-center">
                    <a href="{% url 'core:teacher_home' %}" class="btn btn-outline-secondary btn-sm me-3 rounded-pill px-3">
                        <i class="bi bi-arrow-left"></i> ë‚˜ê°€ê¸°
                    </a>
                    <h4 class="mb-0 fw-bold" style="color: #4a5568;">
                        <i class="bi bi-magic text-primary"></i> ì›”ë§í‰ê°€ ì¶œì œ ë§ˆë²•ì‚¬
                    </h4>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <span class="text-secondary fw-bold" id="total-count-display">ì´ 0ë¬¸ì œ</span>
                    <button type="button" class="btn btn-primary fw-bold px-4 rounded-pill shadow-sm" 
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border:none;" 
                            onclick="submitExam()">
                        <i class="bi bi-printer-fill me-2"></i>ì‹œí—˜ì§€ ìƒì„± ì™„ë£Œ
                    </button>
                </div>
            </div>

            <div class="wizard-body">
                <div class="left-panel">
                    <h6 class="fw-bold text-secondary mb-3"><i class="bi bi-gear-fill me-1"></i> ê¸°ë³¸ ì„¤ì •</h6>
                    
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">í•™ìƒ ì„ íƒ</label>
                        <select name="student_id" class="form-select" required>
                            <option value="">-- í•™ìƒì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            {% for s in students %}
                                <option value="{{ s.id }}">{{ s.name }} ({{ s.current_grade_display }})</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted">ì‹œí—˜ì§€ ì œëª©</label>
                        <input type="text" name="title" class="form-control" placeholder="ì˜ˆ: 3ì›” ì›”ë§í‰ê°€" required>
                    </div>

                    <hr class="my-4">

                    <h6 class="fw-bold text-secondary mb-3"><i class="bi bi-search me-1"></i> ë¬¸ì œ ê²€ìƒ‰</h6>
                    <div class="mb-3">
                        <select id="book-select" class="form-select mb-2">
                            <option value="">êµì¬ ì„ íƒ</option>
                            {% for book in textbooks %}
                                <option value="{{ book.id }}" data-cat="{{ book.category }}">{{ book.title }}</option>
                            {% endfor %}
                        </select>
                        <div class="input-group mb-2">
                            <input type="number" id="ch-start" class="form-control" placeholder="ì‹œì‘ ê°•">
                            <span class="input-group-text bg-white border-start-0 border-end-0">~</span>
                            <input type="number" id="ch-end" class="form-control" placeholder="ë ê°•">
                        </div>
                        <button type="button" class="btn btn-dark w-100 rounded-3" onclick="searchQuestions()">
                            <i class="bi bi-search"></i> ê²€ìƒ‰í•˜ê¸°
                        </button>
                    </div>

                    <div id="search-results" class="flex-grow-1 overflow-auto border rounded p-2 bg-light">
                        <div class="text-center text-muted small mt-5">
                            <i class="bi bi-arrow-up-circle fs-3 d-block mb-2 opacity-50"></i>
                            êµì¬ì™€ ë²”ìœ„ë¥¼ ì„ íƒ í›„<br>ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="section-card">
                        <div class="section-header text-success">
                            <span><i class="bi bi-fonts me-2"></i>Part 1. êµ¬ë¬¸/ì–´ë²•</span>
                            <span class="badge bg-success rounded-pill" id="s1-count">0</span>
                        </div>
                        <div class="p-2 bg-light border-bottom d-flex align-items-center gap-2">
                            <div class="input-group input-group-sm" style="width: 140px;">
                                <span class="input-group-text">ëœë¤</span>
                                <input type="number" id="rnd-cnt-s1" class="form-control" value="10">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="addRandomToSection('S1')">ì¶”ê°€</button>
                            <div class="vr mx-1"></div>
                                <div class="d-flex align-items-center flex-grow-1 justify-content-center">
                                    <span class="badge bg-info text-dark me-1" style="font-size:0.7em;">ê°œë…</span>
                                    
                                    <input type="range" class="form-range w-50" id="ratio-s1" min="0" max="100" value="70"
                                        oninput="document.getElementById('ratioValS1').innerText = this.value + '%'">
                                        
                                    <span class="badge bg-warning text-dark ms-1" style="font-size:0.7em;">ë¶„ì„</span>
                                    
                                    <span id="ratioValS1" class="ms-1 small fw-bold text-muted">70%</span>
                                </div>
                        </div>
                        <div class="section-body" id="section-s1" ondrop="drop(event, 'S1')" ondragover="allowDrop(event)"></div>
                    </div>

                    <div class="section-card">
                        <div class="section-header text-primary">
                            <span><i class="bi bi-book me-2"></i>Part 2. ë…í•´</span>
                            <span class="badge bg-primary rounded-pill" id="s2-count">0</span>
                        </div>
                        <div class="p-2 bg-light border-bottom d-flex align-items-center gap-2">
                            <div class="input-group input-group-sm" style="width: 140px;">
                                <span class="input-group-text">ëœë¤</span>
                                <input type="number" id="rnd-cnt-s2" class="form-control" value="10">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addRandomToSection('S2')">ì¶”ê°€</button>
                            
                            <div class="vr mx-1"></div>
                            <div class="d-flex align-items-center flex-grow-1 justify-content-center">
                                <span class="badge bg-primary text-light me-1" style="font-size:0.7em;">ì§€ë¬¸(ê°œë…)</span>
                                <input type="range" class="form-range w-50" id="ratio-s2" min="0" max="100" value="100" 
                                    oninput="document.getElementById('ratioValS2').innerText = this.value + '%'">
                                <span class="badge bg-warning text-dark ms-1" style="font-size:0.7em;">êµ¬ë¬¸(ë¶„ì„)</span>
                                <span id="ratioValS2" class="ms-1 small fw-bold text-muted">100%</span>
                            </div>
                            </div>
                        <div class="section-body" id="section-s2" ondrop="drop(event, 'S2')" ondragover="allowDrop(event)"></div>
                    </div>
                </div>
            </div>

            <input type="hidden" name="s1_ids" id="s1_ids">
            <input type="hidden" name="s2_ids" id="s2_ids">
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let searchedQuestions = []; 
        let selectedS1 = new Set();
        let selectedS2 = new Set(); 

        // 1. ë¬¸ì œ ê²€ìƒ‰ AJAX
        function searchQuestions() {
            const book = document.getElementById('book-select').value;
            const start = document.getElementById('ch-start').value;
            const end = document.getElementById('ch-end').value;

            if (!book) { alert("êµì¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

            const resultDiv = document.getElementById('search-results');
            resultDiv.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary"></div></div>';

            fetch(`/exam/api/questions/?book=${book}&start=${start}&end=${end}`)
                .then(res => res.json())
                .then(data => {
                    searchedQuestions = data.questions; 
                    renderSearchResults(searchedQuestions);
                })
                .catch(err => {
                    console.error(err);
                    resultDiv.innerHTML = '<p class="text-danger text-center mt-3">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                });
        }

        // 2. ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
        function renderSearchResults(list) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';

            if (!list || list.length === 0) {
                container.innerHTML = '<p class="text-center text-muted mt-5">ê²€ìƒ‰ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.forEach(q => {
                if (selectedS1.has(q.id) || selectedS2.has(q.id)) return;

                const div = document.createElement('div');
                div.className = 'question-item';
                div.draggable = true;
                div.ondragstart = (e) => drag(e, q);
                
                const styleBadge = q.style === 'ANALYSIS' 
                    ? '<span class="badge bg-warning text-dark">ë¶„ì„</span>' 
                    : '<span class="badge bg-info text-dark">ê°œë…</span>';
                
                const catBadge = q.category === 'SYNTAX'
                    ? '<span class="badge bg-success">êµ¬ë¬¸</span>'
                    : '<span class="badge bg-primary">ë…í•´</span>';

                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            ${catBadge} ${styleBadge}
                            <span class="fw-bold small ms-1">${q.chapter}ê°• ${q.number}ë²ˆ</span>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-light border" onclick='moveQuestion(${JSON.stringify(q)}, "S1")'>P1</button>
                            <button type="button" class="btn btn-light border" onclick='moveQuestion(${JSON.stringify(q)}, "S2")'>P2</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // 3. ë¬¸ì œ ì´ë™
        function moveQuestion(q, section) {
            if (selectedS1.has(q.id) || selectedS2.has(q.id)) return;
            
            // ì¹´í…Œê³ ë¦¬ ì²´í¬
            if (section === 'S1' && q.category === 'READING') {
                // í•„ìš”ì‹œ ê²½ê³ ì°½ ì£¼ì„ í•´ì œ
                // alert("ë…í•´ ë¬¸ì œëŠ” Part 2ë¡œ ë³´ë‚´ì£¼ì„¸ìš”."); 
            }

            if (section === 'S1') {
                selectedS1.add(q.id);
                renderAddedItem(q, 'S1');
            } else {
                selectedS2.add(q.id);
                renderAddedItem(q, 'S2');
            }
            
            updateHiddenInputs();
            updateCounts();
        }

        // 4. ì„ íƒëœ ë¬¸ì œ í™”ë©´ì— ê·¸ë¦¬ê¸°
        function renderAddedItem(q, section) {
            const container = document.getElementById(section === 'S1' ? 'section-s1' : 'section-s2');
            
            const div = document.createElement('div');
            div.className = 'question-item added-item';
            div.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold small">${q.chapter}ê°• ${q.number}ë²ˆ</span>
                    <span class="remove-btn" onclick='removeQuestion(${q.id}, "${section}", this)'>
                        <i class="bi bi-x-circle-fill"></i>
                    </span>
                </div>
            `;
            container.appendChild(div);
        }

        // 5. ë¬¸ì œ ì‚­ì œ
        function removeQuestion(id, section, btn) {
            if (section === 'S1') selectedS1.delete(id);
            else selectedS2.delete(id);
            
            // í™”ë©´ì—ì„œ ì œê±°
            btn.closest('.question-item').remove();
            updateHiddenInputs();
            updateCounts();
        }

        // 6. ìˆ¨ê²¨ì§„ input ì—…ë°ì´íŠ¸ (Form ì „ì†¡ìš©)
        function updateHiddenInputs() {
            document.getElementById('s1_ids').value = Array.from(selectedS1).join(',');
            document.getElementById('s2_ids').value = Array.from(selectedS2).join(',');
        }

        // 7. ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateCounts() {
            const c1 = selectedS1.size;
            const c2 = selectedS2.size;
            document.getElementById('s1-count').innerText = c1;
            document.getElementById('s2-count').innerText = c2;
            document.getElementById('total-count-display').innerText = `ì´ ${c1 + c2}ë¬¸ì œ`;
        }

        // 8. ì‹œí—˜ì§€ ìƒì„± ì œì¶œ
        function submitExam() {
            if (selectedS1.size === 0 && selectedS2.size === 0) {
                alert("ìµœì†Œ 1ë¬¸ì œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }
            document.getElementById('examForm').submit();
        }
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì› í•¨ìˆ˜ (ì„ íƒ ì‚¬í•­)
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev, q) { ev.dataTransfer.setData("text", JSON.stringify(q)); }
        function drop(ev, section) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            try {
                const q = JSON.parse(data);
                moveQuestion(q, section);
            } catch(e) {}
        }

        function addRandomToSection(section) {
            const book = document.getElementById('book-select').value; // ì•„ê¹Œ ìˆ˜ì •í•œ ID ì‚¬ìš© ì£¼ì˜
            const start = document.getElementById('ch-start').value;
            const end = document.getElementById('ch-end').value;
            
            if (!book) { alert("êµì¬ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

            const countInput = document.getElementById(section === 'S1' ? 'rnd-cnt-s1' : 'rnd-cnt-s2');
            const ratioInput = document.getElementById(section === 'S1' ? 'ratio-s1' : 'ratio-s2'); // ì—¬ê¸°ì„œ ìŠ¬ë¼ì´ë” ê°’ì„ ê°€ì ¸ì˜´
            
            const count = parseInt(countInput.value) || 0;
            const ratio = parseInt(ratioInput.value) || 100; // ê°œë…(ì§€ë¬¸) ë¹„ìœ¨

            if (count <= 0) { alert("ë¬¸í•­ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            // AJAX ìš”ì²­ìœ¼ë¡œ ëœë¤ ë¬¸ì œ ID ë°›ì•„ì˜¤ê¸° (ë°±ì—”ë“œ API í•„ìš”)
            // ì„ì‹œë¡œ í™”ë©´ì— ìˆëŠ” searchedQuestionsì—ì„œ ë½‘ëŠ” ë¡œì§ ì˜ˆì‹œ:
            if (searchedQuestions.length === 0) {
                alert("ë¨¼ì € ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¬¸ì œ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.\n(ëª©ë¡ ë‚´ì—ì„œ ëœë¤ìœ¼ë¡œ ì„ íƒë©ë‹ˆë‹¤)");
                return;
            }

            // í˜„ì¬ ì„¹ì…˜ì— ì´ë¯¸ ë‹´ê¸´ ë¬¸ì œ ì œì™¸
            const currentSet = section === 'S1' ? selectedS1 : selectedS2;
            
            // ë¹„ìœ¨ì— ë”°ë¼ ìŠ¤íƒ€ì¼ í•„í„°ë§
            // ë¹„ìœ¨ì´ 100ì´ë©´ CONCEPTë§Œ, 0ì´ë©´ ANALYSISë§Œ, 50ì´ë©´ ë°˜ë°˜ ë“± ë¡œì§ ì ìš©
            // (ê°„ë‹¨í•˜ê²Œ êµ¬í˜„: ì „ì²´ í›„ë³´ ì¤‘ ì•„ì§ ì•ˆ ë‹´ì€ ê²ƒ ì„ì–´ì„œ countë§Œí¼ ì¶”ê°€)
            
            let candidates = searchedQuestions.filter(q => !selectedS1.has(q.id) && !selectedS2.has(q.id));
            
            // [ë¹„ìœ¨ ë¡œì§ ì ìš©]
            // 1. CONCEPT(ì§€ë¬¸)ì™€ ANALYSIS(êµ¬ë¬¸) ë¶„ë¥˜
            const concepts = candidates.filter(q => q.style === 'CONCEPT');
            const analyses = candidates.filter(q => q.style === 'ANALYSIS');
            
            const conceptCount = Math.round(count * (ratio / 100));
            const analysisCount = count - conceptCount;

            // 2. ì…”í”Œ í•¨ìˆ˜
            const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
            
            const pickedConcepts = shuffle(concepts).slice(0, conceptCount);
            const pickedAnalyses = shuffle(analyses).slice(0, analysisCount);
            
            const finalPicks = [...pickedConcepts, ...pickedAnalyses];

            if (finalPicks.length === 0) {
                alert("ì¡°ê±´ì— ë§ëŠ” ë‚¨ì€ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // 3. ë‹´ê¸°
            finalPicks.forEach(q => {
                if (section === 'S1') {
                    selectedS1.add(q.id);
                    renderAddedItem(q, 'S1');
                } else {
                    selectedS2.add(q.id);
                    renderAddedItem(q, 'S2');
                }
            });

            updateHiddenInputs();
            updateCounts();
            alert(`${finalPicks.length}ë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
    </script>
</body>
</html>

