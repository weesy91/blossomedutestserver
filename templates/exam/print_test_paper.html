<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ paper.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
        body { font-family: 'Nanum Gothic', sans-serif; background-color: #525659; margin: 0; padding: 0; }

        .page {
            background: white; width: 210mm; min-height: 297mm;
            margin: 10mm auto; padding: 15mm 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            position: relative; box-sizing: border-box;
            page-break-after: always;
        }

        .section-header {
            border-bottom: 2px solid #000;
            padding-bottom: 5px; margin-bottom: 15px;
            font-weight: 800; color: #000;
        }

        .question-block {
            break-inside: avoid; page-break-inside: avoid;
            margin-bottom: 8mm; width: 100%;
        }

        .q-reading-concept { width: 48%; display: inline-block; vertical-align: top; margin-right: 2%; }
        .q-reading-analysis { 
            width: 100%; display: block; clear: both; 
            border-top: 1px dashed #ccc; padding-top: 10mm; margin-top: 5mm;
        }

        .q-num {
            font-size: 1.1rem; font-weight: 800; color: #000;
            border-bottom: 2px solid #000; display: inline-block;
            margin-bottom: 5px; padding-right: 8px;
        }

        .q-img { max-width: 100%; height: auto; display: block; margin-bottom: 8px; }

        /* [í•µì‹¬] ìœ í˜•ë³„ ë¡œì§ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .logic-box {
            font-size: 0.8rem; border: 1px solid #aaa; padding: 8px;
            border-radius: 4px; background-color: #fcfcfc; margin-top: 5px;
        }
        .logic-title { font-weight: bold; border-bottom: 1px dashed #ccc; margin-bottom: 4px; padding-bottom: 2px; }

        @media print {
            body { background: white; }
            .page { margin: 0 !important; box-shadow: none; width: 100%; }
            .no-print { display: none !important; }
            .no-print-padding { padding-top: 0 !important; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark fixed-top no-print">
        <div class="container-fluid justify-content-between">
            <span class="navbar-text text-white fw-bold">ğŸ“„ {{ paper.title }}</span>
            <div>
                <a href="javascript:history.back()" class="btn btn-secondary btn-sm me-2">ë’¤ë¡œê°€ê¸°</a>
                <button onclick="window.print()" class="btn btn-primary btn-sm fw-bold">ğŸ–¨ï¸ PDF ì €ì¥ / ì¸ì‡„</button>
            </div>
        </div>
    </nav>

    <div style="padding-top: 60px;" class="no-print-padding"> 
        
        <div class="page d-flex flex-column justify-content-center align-items-center text-center">
            <div style="border: 3px double #333; padding: 50px; width: 85%;">
                <h1 class="display-4 fw-bold mb-4">MONTHLY TEST</h1>
                <h2 class="mb-5 fw-bold">{{ paper.title }}</h2>
                <hr class="my-5">
                <table class="table table-bordered mb-0">
                    <tr>
                        <th class="bg-light w-25 align-middle">ì´ë¦„</th>
                        <td class="fs-3 fw-bold py-3">{{ paper.student.name }}</td>
                    </tr>
                    <tr>
                        <th class="bg-light align-middle">ì ìˆ˜</th>
                        <td class="fs-3 fw-bold py-3" style="color:#ddd;"> / {{ total_count }}</td>
                    </tr>
                </table>
            </div>
            <div class="mt-5 text-muted">
                <p>Date: {% now "Y. m. d" %}</p>
                <p class="small">Blossom Edu English Academy</p>
            </div>
        </div>

        <div class="page">
            
            {% if s1_questions %}
            <h4 class="section-header">SECTION 1. êµ¬ë¬¸ ë° ì–´ë²•</h4>
            <div class="layout-syntax">
                {% for q in s1_questions %}
                <div class="question-block">
                    <div class="q-num">Q{{ forloop.counter }}.</div>
                    {% if q.image %}<img src="{{ q.image.url }}" class="q-img">{% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if s2_questions %}
            <h4 class="section-header mt-5">SECTION 2. ë…í•´ (Reading)</h4>
            <div class="layout-reading-container">
                {% for q in s2_questions %}
                    
                    {% if q.style == 'CONCEPT' %}
                        <div class="question-block q-reading-concept">
                            <div class="q-num">Q{{ forloop.counter|add:s1_questions.count }}.</div>
                            {% if q.image %}<img src="{{ q.image.url }}" class="q-img">{% endif %}
                            
                            <div class="logic-box">
                                <div class="logic-title">âœï¸ Logic Check ({{ q.reading_type|default:"ê¸°ë³¸" }})</div>
                                
                                {% if q.reading_type == 'TOPIC' %}
                                    <div class="mb-1">â‘  ì†Œì¬: ____________________</div>
                                    <div>â‘¡ ìš”ì§€(í•œë¬¸ì¥): ____________________</div>
                                
                                {% elif q.reading_type == 'LOGIC' %}
                                    <div class="mb-1">â‘  ì—°ê²° ë‹¨ì„œ(ì§€ì‹œì–´/ì—°ê²°ì‚¬): __________</div>
                                    <div>â‘¡ ê¸€ì˜ ìˆœì„œ/ìœ„ì¹˜ ê·¼ê±°: _____________</div>

                                {% elif q.reading_type == 'BLANK' %}
                                    <div class="mb-1">â‘  ë¹ˆì¹¸ ë¬¸ì¥ í•´ì„: _________________</div>
                                    <div>â‘¡ ë¹ˆì¹¸ ì¶”ë¡  ê·¼ê±°(ì¬ì§„ìˆ ): ___________</div>

                                {% elif q.reading_type == 'DETAIL' %}
                                    <div class="mb-1">â‘  ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë³´ê¸° ë²ˆí˜¸: _____</div>
                                    <div>â‘¡ ì •ë‹µì¸ ì´ìœ : ____________________</div>

                                {% else %}
                                    <div class="mb-1">â‘  ì†Œì¬: ____________________</div>
                                    <div>â‘¡ ì£¼ì œ: ____________________</div>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <div class="question-block q-reading-analysis">
                            <div class="q-num">Q{{ forloop.counter|add:s1_questions.count }}.</div>
                            {% if q.image %}<img src="{{ q.image.url }}" class="q-img">{% endif %}
                            <div class="text-muted small mt-2">â€» ìœ„ ì§€ë¬¸ì˜ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë¶„ì„(S, V, O, C, [ ])í•˜ê³  í•´ì„í•˜ì‹œì˜¤.</div>
                        </div>
                    {% endif %}

                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="page">
            <h4 class="section-header">Answer Key (ì •ë‹µì§€)</h4>
            <div class="row">
                {% for q in s1_questions %}
                <div class="col-6 mb-4" style="page-break-inside: avoid;">
                    <div class="fw-bold small">Q{{ forloop.counter }} ì •ë‹µ (Section 1)</div>
                    {% if q.answer_image %}<img src="{{ q.answer_image.url }}" class="img-fluid border" style="max-height: 180px;">{% endif %}
                </div>
                {% endfor %}

                {% for q in s2_questions %}
                <div class="col-6 mb-4" style="page-break-inside: avoid;">
                    <div class="fw-bold small">Q{{ forloop.counter|add:s1_questions.count }} ì •ë‹µ (Section 2)</div>
                    {% if q.answer_image %}<img src="{{ q.answer_image.url }}" class="img-fluid border" style="max-height: 180px;">{% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</body>
</html>